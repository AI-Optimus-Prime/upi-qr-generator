<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced UPI QR Code Generator</title>
    
    <!-- 1. Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. QR Code Generation Library (qrcode.js) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

    <!-- 3. Google Fonts for a clean look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* Use the Inter font family */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ensure the QR code canvas/img fills its container */
        #qrcode > * {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-start justify-center min-h-screen p-4 py-8">

    <div class="w-full max-w-md bg-white rounded-xl shadow-lg">
        
        <!-- Header Section with Razorpay Theme -->
        <div class="bg-blue-600 text-white p-6 rounded-t-xl">
            <h1 class="text-2xl md:text-3xl font-bold">Dynamic UPI QR Code Generator</h1>
            <p class="text-blue-200 mt-1">Real-time QR codes for seamless payments.</p>
        </div>

        <div class="p-6 md:p-8" id="formContainer">
            <!-- Form Section -->
            <div class="grid grid-cols-1 gap-6">
                
                <!-- Payee Name -->
                <div>
                    <label for="payeeName" class="block text-sm font-medium text-gray-700 mb-1">Your Name (Payee)</label>
                    <input type="text" id="payeeName" placeholder="e.g. Acme Fresh Produce" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>

                <!-- UPI ID Input -->
                <div>
                    <label for="upiId" class="block text-sm font-medium text-gray-700 mb-1">Your UPI ID (VPA)</label>
                    <input type="text" id="upiId" placeholder="yourname@oksbi" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                </div>

                <!-- Optional Fields -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Amount (Optional)</label>
                        <input type="number" id="amount" placeholder="e.g. 100" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                    <div>
                        <label for="remarks" class="block text-sm font-medium text-gray-700 mb-1">Remarks (Optional)</label>
                        <input type="text" id="remarks" placeholder="e.g. For Invoice #123" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                    </div>
                </div>

                <!-- QR Code Display Section (Now always visible) -->
                <div id="qrCodeContainer" class="flex flex-col items-center pt-4 border-t mt-4">
                    <h2 id="qrTitle" class="text-lg font-semibold text-gray-700 mb-4">QR Code Preview</h2>
                    <div id="qrcode" class="p-4 bg-white border rounded-lg shadow-inner w-64 h-64"></div>
                    <p id="qrHelperText" class="text-gray-500 text-sm mt-2 text-center">Enter your details above to generate a QR code.</p>
                    <button id="downloadBtn" class="mt-6 w-full md:w-auto bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" disabled>
                        Download as PNG
                    </button>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- Element Selectors ---
        const formContainer = document.getElementById('formContainer');
        const downloadBtn = document.getElementById('downloadBtn');
        const qrcodeDiv = document.getElementById('qrcode');
        const qrTitle = document.getElementById('qrTitle');
        const qrHelperText = document.getElementById('qrHelperText');
        
        // Input fields
        const payeeNameInput = document.getElementById('payeeName');
        const upiIdInput = document.getElementById('upiId');
        const amountInput = document.getElementById('amount');
        const remarksInput = document.getElementById('remarks');

        let qrcode = null; // To hold the QRCode object

        // --- Placeholder QR Generation ---
        const generatePlaceholderQr = () => {
            qrcodeDiv.innerHTML = ''; // Clear previous QR
            new QRCode(qrcodeDiv, {
                text: "https://github.com/srikanthlogic/CashlessConsumer", // Generic, non-payable link
                width: 256,
                height: 256,
                colorDark: "#d1d5db", // gray-300
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            qrTitle.textContent = 'QR Code Preview';
            qrHelperText.textContent = 'Enter your details above to generate a QR code.';
            downloadBtn.disabled = true; // Disable download for placeholder
        };

        // --- Core Logic: Generate Real QR Code Dynamically ---
        const generateRealQrCode = () => {
            const payeeName = payeeNameInput.value.trim();
            const payeeAddress = upiIdInput.value.trim();
            const amount = amountInput.value.trim();
            const remarks = remarksInput.value.trim();

            // 1. Check for valid inputs
            const isValid = payeeName && payeeAddress && payeeAddress.includes('@');

            if (!isValid) {
                generatePlaceholderQr(); // If inputs become invalid, revert to placeholder
                return;
            }

            // 2. Construct the UPI String
            let upiString = `upi://pay?pa=${encodeURIComponent(payeeAddress)}&pn=${encodeURIComponent(payeeName)}`;
            if (amount) {
                upiString += `&am=${encodeURIComponent(amount)}`;
            }
            if (remarks) {
                upiString += `&tn=${encodeURIComponent(remarks)}`;
            }
            upiString += '&cu=INR';

            // 3. Generate the Real QR Code
            qrcodeDiv.innerHTML = ''; // Clear placeholder
            qrcode = new QRCode(qrcodeDiv, {
                text: upiString,
                width: 256,
                height: 256,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            // 4. Update UI text and enable download
            qrTitle.textContent = 'Your QR Code is Ready!';
            qrHelperText.textContent = 'Scan this with any UPI app.';
            downloadBtn.disabled = false;
        };

        // --- Event Listeners ---

        // Listen for any input change in the form container
        formContainer.addEventListener('input', generateRealQrCode);

        // Event Listener for the Download Button
        downloadBtn.addEventListener('click', () => {
            if (downloadBtn.disabled) return; // Extra safety check

            const qrImage = qrcodeDiv.querySelector('img');
            if (qrImage) {
                const link = document.createElement('a');
                link.href = qrImage.src;
                const safeFileName = payeeNameInput.value.trim().replace(/[^a-z0-9]/gi, '_').toLowerCase();
                link.download = `upi-qr-code-${safeFileName || 'payment'}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        });

        // --- Initial Load ---
        // Generate the placeholder QR as soon as the page loads
        window.addEventListener('load', generatePlaceholderQr);

    </script>
</body>
</html>
